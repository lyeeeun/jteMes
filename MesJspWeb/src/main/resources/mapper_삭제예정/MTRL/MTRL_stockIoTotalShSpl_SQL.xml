<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MTRL_stockIoTotalShSpl">
<!-- 	             FN_CM_GETCOMNM(MI.CTR_CD , 'MTRLTYPE',M.MTRLTYPE) AS MTRLTYPE            
				 FN_CM_GETCOMNM(MI.CTR_CD , 'MTRLUNITCD',M.MTRLUNIT_CD )  AS UNIT_NM -->
	
	<!-- 자재입고 리스트 -->
	<select id="selectList" parameterType="hashmap"
		resultType="hashmap">
		SELECT S.SUPPLIERNAME
	            , M.MTRLNAME
	            , M.MTRLCMPT
	            , M.MTRLSPEC
	            , SUM(MI.MTRL_IN_QTY) AS MTRL_IN_QTY
	            , SUM(MTRL_OUT_TOT_QTY) AS MTRL_OUT_TOT_QTY
	            , M.MTRLTYPE           
				, M.MTRLUNIT_CD AS UNIT_NM   
	       FROM (  SELECT MTRLID
	       				, CTR_CD 
	                    , SUPPLIERID
	                    , MTRL_IN_DATE
	                    , MTRL_IN_QTY
	                    , MTRL_OUT_TOT_QTY
	                    FROM TB_MESMTRLIN 
	                    WHERE 1=1
	                    <if test='STR_DT != null and STR_DT != ""'>
	                    AND MTRL_IN_DATE BETWEEN STR_TO_DATE(#{STR_DT}, '%Y-%m-%D 00:00:00')
			            AND STR_TO_DATE(#{END_DT}, '%Y-%m-%D 23:59:59')
	                    </if>
	             		<if test='DEL_GBN != null and DEL_GBN != ""'>
	                     AND DEL_GBN='N' 
	                    </if>
	                    )AS MI
	       INNER JOIN TB_MATERIAL M ON M.MTRLID=MI.MTRLID  
	       INNER JOIN TB_SUPPLIER S ON S.SUPPLIERID = MI.SUPPLIERID                     
	       WHERE 1=1
	        <if test='MTRLNAME != null and MTRLNAME != ""'>
				AND MTRLNAME LIKE CONCAT("%" #{MTRLNAME} "%")  
			</if>
			<if test='SUPPLIERNAME != null and SUPPLIERNAME != ""'>
				AND SUPPLIERNAME LIKE CONCAT("%" #{SUPPLIERNAME} "%")
			</if> 
	     
	     
	      GROUP BY MI.MTRLID,MI.SUPPLIERID , S.SUPPLIERNAME,M.MTRLNAME ,M.MTRLTYPE,M.MTRLCMPT,M.MTRLSPEC,MI.CTR_CD,M.MTRLUNIT_CD

	</select>

</mapper>