<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SHIP_stockTotalShClnt">
<!-- 	                 , FN_CM_GETCOMNM(PI.CTR_CD , 'PRODTYPE', P.PRODTYPE) AS PRODTYPE        
			         , FN_CM_GETCOMNM(PI.CTR_CD , 'PRODSPEC', P.PRODSPEC) AS PRODSPEC        
					 , FN_CM_GETCOMNM(PI.CTR_CD , 'PRODUNITCD',P.PRODUNIT_CD )  AS UNIT_NM  -->
	<!-- 제품입고 리스트 가져오기 -->
	<select id="selectStockTotalList" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
	      SELECT       C.CUSTOMERNAME                                                 	
	                 , P.PRODNAME                                                     		
	                 , P.PRODMTRL													  		 
	                 , P.PRODTYPE       
			         , P.PRODSPEC       
					 , P.PRODUNIT_CD AS UNIT_NM  										   
	                 , SUM(PROD_IN_QTY) AS PROD_IN_QTY                        		 
	                 , SUM(PROD_OUT_TOT_QTY) AS PROD_OUT_TOT_QTY             		 
			FROM TB_MESPRODIN PI
			LEFT JOIN TB_PRODUCT P ON PI.PRODID = P.PRODID
			LEFT JOIN TB_CUSTOMER C ON PI.CUSTOMERID = C.CUSTOMERID
			WHERE 1 = 1
			 AND PI.PROD_IN_QTY - PI.PROD_OUT_TOT_QTY > 0   
		]]>
<!-- 		하드코딩으로 인한 삭제 -->
<!-- 		WHERE 1 = 1 -->
<!-- 			 AND PI.CTR_CD = 'ATOS_MES' -->
<!-- 			 AND PI.PROD_IN_QTY - PI.PROD_OUT_TOT_QTY > 0 -->
		<!--  삭제 구분에 N 즉 삭제된 데이터가 아닌경우 -->
		<if test='DEL_GBN != "N"'>
			AND PI.DEL_GBN ='N'
		</if>
		<!-- 검색 날짜가 null이 아닐경우 -->
		<if test='STR_DT != null and STR_DT != ""'>
			AND PROD_IN_DATE BETWEEN STR_TO_DATE(#{STR_DT},'%Y%m%d') 
			AND STR_TO_DATE(#{END_DT},'%Y%m%d') 
		</if>
		<!--제품명이 null이 아닌 경우 제품명에 따른 검색이 가능하게함  -->
		<if test='PRODNAME != null and PRODNAME != ""'>
			AND PRODNAME LIKE CONCAT("%"#{PRODNAME}"%")
		</if>
		<!--고객사가 null이 아닌 경우 고객사에 따른 검색이 가능하게함  -->
		<if test='CUSTOMERNAME != null and CUSTOMERNAME != ""'>
				AND CUSTOMERNAME LIKE CONCAT("%"#{CUSTOMERNAME}"%")
		</if>
		 GROUP BY PI.CTR_CD , C.CUSTOMERNAME,P.PRODNAME , P.PRODTYPE , P.PRODMTRL , P.PRODSPEC , P.PRODUNIT_CD
	</select>

</mapper>