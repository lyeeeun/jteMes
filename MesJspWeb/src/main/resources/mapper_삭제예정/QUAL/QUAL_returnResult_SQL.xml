<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="QUAL_returnResult">
<!-- 		            , FN_CM_GETCOMNM(O.CTR_CD , 'PRODTYPE', P.PRODTYPE) AS PRODTYPE      
			        , FN_CM_GETCOMNM(O.CTR_CD , 'PRODSPEC', P.PRODSPEC) AS PRODSPEC       
				    , FN_CM_GETCOMNM(O.CTR_CD , 'PRODUNITCD',P.PRODUNIT_CD )  AS UNIT_NM -->
	<select id="resultList" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
	        SELECT    O.RTN_NO                                   
		            , DATE_FORMAT(O.RTN_DATE,'%Y%m%d') AS RTN_DATE 
		            , O.PROD_OUT_NO                                  
		            , O.ORDER_NO                                     
		            , O.CUSTOMERID
		            , C.CUSTOMERNAME                                 
		            , O.PRODID
		            , P.PRODNAME                                   
		            , P.PRODMTRL
		            , P.PRODTYPE    
			        , P.PRODSPEC     
				    , P.PRODUNIT_CD AS UNIT_NM                                
		            , O.UNIT_CD
		            , O.RETURN_CAUSE_CD
		            , O.RTN_QTY  
		            , O.RT_REMARK                  
			FROM TB_MESPRODRETURN O
			INNER JOIN TB_CUSTOMER C ON O.CUSTOMERID=C.CUSTOMERID
			INNER JOIN TB_PRODUCT P ON O.PRODID = P.PRODID
		WHERE 1=1 
		]]>
		<!--  삭제 구분에 N 즉 삭제된 데이터가 아닌경우 -->
		<if test='DEL_GBN != "N"'>
			AND O.DEL_GBN ='N'
		</if>
		<!--고객사가 null이 아닌 경우 고객사에 따른 검색이 가능하게함  -->
		<if test='CUSTOMERNAME != null and CUSTOMERNAME != ""'>
			AND CUSTOMERNAME LIKE CONCAT("%"#{CUSTOMERNAME}"%") 
		</if>
        <!--제품명이 null이 아닌 경우 제품명에 따른 검색이 가능하게함  -->
		<if test='PRODNAME != null and PRODNAME != ""'>
			AND PRODNAME LIKE CONCAT("%"#{PRODNAME}"%")  
		</if>
		<!-- 검색 날짜가 null이 아닐경우 -->
		<if test='STR_DT != null and STR_DT != ""'>
			AND DATE_FORMAT(RTN_DATE,'%Y%m%d') BETWEEN DATE_FORMAT(#{STR_DT},'%Y%m%d') 
			AND DATE_FORMAT(#{END_DT},'%Y%m%d')
		</if>
		    ORDER BY ORDER_NO
	</select>
	
	<!-- 반품원인 리스트 -->
	<select id="selectProductReturnList" resultType="hashmap">
		SELECT 	 COM_CD,
			     COM_NM 
		FROM     TB_COMCDINF 
		WHERE    GRP_CD = 'RETURN' 
	</select>

	<select id="updateProductReturnList1" parameterType="hashmap"
		resultType="java.lang.Integer">
		<![CDATA[
		    UPDATE TB_MESPRODRETURN
		        SET RT_REMARK = #{RT_REMARK}
		        	,RETURN_CAUSE_CD = #{RETURN_CAUSE_CD}
		     WHERE RTN_NO=#{RTN_NO}
		]]>
	</select>

</mapper>