<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PROD_MFOrderShDel">
<!--FN_CM_GETCOMNM(MW.CTR_CD , 'PRODTYPE', P.PRODTYPE) AS PRODTYPE
    FN_CM_GETCOMNM(MW.CTR_CD , 'PRODSPEC', P.PRODSPEC) AS PRODSPEC 
    FN_CM_GETCOMNM(MW.CTR_CD , 'PRODUNITCD',P.PRODUNIT_CD )  AS UNIT_NM -->
	<select id="selectMFOrderList" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
		 SELECT            MW.WOID                                       
		                 , DATE_FORMAT(MW.WO_DATE,'%Y%m%d') AS WO_DATE   
		                 , MW.ORDER_NO                                 
		                 , MW.CUSTOMERID                                
		                 , MW.PRODID                                
		                 , C.CUSTOMERNAME                                
					     , P.PRODNAME
						 , P.PRODTYPE
						 , P.PRODMTRL
						 , P.PRODSPEC   
					     , P.PRODUNIT_CD AS UNIT_NM         
			        	 , MW.SHOPFLOOR_QTY                        
		                 , MW.OUT_TOT_QTY                       
		                 , MW.REMARK      AS MWREMARK              
		                 , O.REMARK       AS OREMARK            
    	                 , MW.DEL_GBN                              
			FROM TB_MESWORKORDER MW
			INNER JOIN TB_CUSTOMER C ON MW.CUSTOMERID=C.CUSTOMERID
			INNER JOIN TB_PRODUCT P ON MW.PRODID=P.PRODID
			INNER JOIN TB_MESORDER O ON MW.ORDER_NO = O.ORDER_NO
		WHERE 1=1
		]]>
		<!--  삭제 구분에 N 즉 삭제된 데이터가 아닌경우 -->
		<if test='DEL_GBN != "N"'>
			AND MW.DEL_GBN ='N'
		</if>
		<!-- 검색 날짜가 null이 아닐경우 -->
		<if test='STR_DT != null and STR_DT != ""'>
			AND WO_DATE BETWEEN DATE_FORMAT(#{STR_DT}, '%Y-%m-%D')
			AND DATE_FORMAT(#{END_DT}, '%Y-%m-%D')
			<!--AND WO_DATE BETWEEN TO_DATE(#{STR_DT} || ' 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
			AND TO_DATE(#{END_DT} || ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS') --> 
		</if>
		<!--고객사가 null이 아닌 경우 고객사에 따른 검색이 가능하게함  -->
		<if test='CUSTOMERNAME != null and CUSTOMERNAME != ""'>
				AND CUSTOMERNAME LIKE CONCAT("%"#{CUSTOMERNAME}"%")
		</if>
        <!--제품명이 null이 아닌 경우 제품명에 따른 검색이 가능하게함  -->
		<if test='PRODNAME != null and PRODNAME != ""'>
			AND PRODNAME LIKE CONCAT("%"#{PRODNAME}"%")
		</if>
		    ORDER BY WOID
	</select>


	<!-- 고객사 드롭박스 콤보에 들어가기 위해 필요 -->
	<select id="selectCustomerList" parameterType="hashmap"	resultType="hashmap">

		SELECT CUSTOMERNAME,
		CUSTOMERID

		FROM TB_CUSTOMER

		ORDER BY CUSTOMERID
	</select>


	<!-- 제품 드롭박스 콤보에 들어가기 위해 필요 -->
	<select id="selectProductList" parameterType="hashmap"	resultType="hashmap">

		SELECT PRODNAME,
		PRODID
		FROM TB_PRODUCT
		ORDER BY PRODID
	</select>

	<select id="selectpreSave" parameterType="hashmap"
		resultType="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) AS CNT      
			FROM TB_MESWORKORDER       -- [TB_제조지시목록]
			WHERE WOID     =     #{WOID}
		]]>
	</select>

	<!-- 저장번튼 클릭시 테이블에서 해당 컬럼의 update처리를해준다. -->
	<select id="updateMFOList2" parameterType="hashmap"
		resultType="hashmap">
	<![CDATA[
			   UPDATE TB_MESWORKORDER
			    SET REMARK = #{MWREMARK}
			    WHERE WOID=#{WOID}
		]]>
	</select>



</mapper>